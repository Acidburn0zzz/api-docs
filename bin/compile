#!/usr/bin/env sh

# This is a script to compile our API documentation.
#
# Dependencies:
#   - node.js/npm
#
# Usage: `bin/compile`

WD="$(pwd)"
DIR="$( cd "$(dirname "$0")/.." && pwd )"

npm install

for file in `find "$DIR/docs" -type f -name "*.md"`; do
  if [[ -z "$first_run" ]]; then
    echo >> "$DIR/build.md"
  else
    $first_run=true
  fi

  cat $file >> "$DIR/build.md"
done

rm -rf "$DIR/web"
mkdir "$DIR/web"
$(npm bin)/aglio -t default-multi -i "$DIR/build.md" -o "$DIR/web/index.html"
rm -rf "$DIR/build.md"

# Finally, go back to where the user started.
cd $WD
exit 0
